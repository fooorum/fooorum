---
import Layout from "@layouts/Layout.astro";
import Comments from "@components/feeds/CommentTree.astro";
import Card from "@components/cards/Post.astro";
import { eq, Post } from "astro:db";
import { selectPosts } from "@lib/db";

const postId = parseInt(Astro.params.postId!);

const [post] = await selectPosts({ userId: Astro.locals.user?.id }).where(
  eq(Post.id, postId),
);

if (post.isDeleted) return new Response(null, { status: 410 });
---

<Layout title={post.postTitle ?? "Post"}>
  <Card active {...post} comments={undefined} />
  <Comments parent={post.postId} />
</Layout>
