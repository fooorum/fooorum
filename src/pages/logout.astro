---
import Layout from "@layouts/Layout.astro";
import Stack from "@components/feeds/Stack.astro";
import { Icon } from "astro-icon/components";
import Card from "@components/cards/User.astro";
import Separator from "@components/feeds/Separator.astro";
import { db, User, eq } from "astro:db";

const { user } = Astro.locals;
if (!user) {
  return Astro.redirect("/login");
}

const [fullUser] = await db
  .select({
    userName: User.name,
    userId: User.id,
    userDescription: User.description,
  })
  .from(User)
  .where(eq(User.id, user.id));
---

<Layout title="Abmelden">
  <form method="post" action="/api/logout" data-astro-reload>
    <Stack>
      <Card {...fullUser} />
      <Separator />
      <button><Icon name="material-symbols:logout" /> Abmelden</button>
    </Stack>
  </form>
</Layout>
