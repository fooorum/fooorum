---
import Image from "@components/attachements/Image.astro";
import Audio from "@components/attachements/Audio.astro";
import Video from "@components/attachements/Video.astro";
import YouTube, { getYouTubeId } from "@components/attachements/YouTube.astro";
import Embed from "@components/attachements/Embed.astro";
import mimeTypes from "@lib/caches/MimeTypes";

interface Props {
  url: string;
}
const { url } = Astro.props;

const Component = await selectComponent(url);

export async function selectComponent(url: string) {
  const mimeType = await mimeTypes.fetch(url);
  switch (mimeType) {
    case "image":
      return Image;
    case "audio":
      return Audio;
    case "video":
      return Video;
  }
  if (getYouTubeId(url)) {
    return YouTube;
  }
  return Embed;
}
---

<Component url={url} />
